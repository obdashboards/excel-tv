<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Excel TV Display</title>
  <style>
    html, body { height: 100%; margin: 0; background: #000; }
    #wrap { position: fixed; inset: 0; }
    #excelFrame {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      border: 0;
      background: #111;
    }
    #hint {
      position: absolute; left: 0; right: 0; bottom: 0;
      font: 14px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: rgba(255,255,255,.7);
      text-align: center; padding: 8px 10px;
      pointer-events: none;
    }
    #controls {
      position: absolute; top: 8px; right: 8px; display: flex; gap: 8px;
    }
    button {
      font: 14px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      padding: 8px 10px; border-radius: 10px; border: 0;
      background: rgba(255,255,255,.12); color: #fff; cursor: pointer;
    }
    button:active { transform: scale(.98); }
  </style>
  <script>
    // ==== CONFIG ====
    // Paste your Excel embed URL (the src from the iframe) between the quotes.
    // Example ends with: action=embedview&wdAllowInteractivity=True&wdHideGridlines=True&wdHideHeaders=True&wdHideSheetTabs=True
    const EXCEL_EMBED_URL = "https://obconstruction-my.sharepoint.com/personal/patricia_oboyle_signtime_co_uk/_layouts/15/Doc.aspx?sourcedoc={ea9e8047-a1e8-4de0-a8bc-5437f9ec6d80}&action=embedview&AllowTyping=True&ActiveCell=A1&wdHideHeaders=True&wdDownloadButton=True&wdInConfigurator=True&wdInConfigurator=True";
    // Refresh interval in seconds
    const REFRESH_SECONDS = 1800; // change as needed

    // ==== CODE ====
    const frame = () => document.getElementById('excelFrame');
    const withCacheBust = (base) => {
      if (!base) return "";
      const sep = base.includes("?") ? "&" : "?";
      return base + sep + "t=" + Date.now();
    };

    function reloadFrame() {
      const url = withCacheBust(EXCEL_EMBED_URL);
      if (frame().src === "") {
        frame().src = url;
      } else {
        // Replace iframe to ensure a clean reload (helps some TV browsers)
        const old = frame();
        const fresh = old.cloneNode();
        fresh.id = "excelFrame";
        fresh.src = url;
        old.replaceWith(fresh);
      }
      updateHint();
    }

    function updateHint() {
      const ts = new Date().toLocaleTimeString();
      document.getElementById('hint').textContent = "Last refreshed: " + ts + " • Interval: " + REFRESH_SECONDS + "s";
    }

    function goFullscreen() {
      const el = document.documentElement;
      if (el.requestFullscreen) el.requestFullscreen();
      else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
      else if (el.msRequestFullscreen) el.msRequestFullscreen();
    }

    document.addEventListener('DOMContentLoaded', () => {
      reloadFrame();
      setInterval(reloadFrame, REFRESH_SECONDS * 1000);

      // Many TV remotes send Enter/OK as "Enter"
      document.addEventListener('keydown', (e) => {
        if (e.key && (e.key.toLowerCase() === "enter" || e.key.toLowerCase() === "ok")) {
          goFullscreen();
        }
      });
    });
  </script>
</head>
<body>
  <div id="wrap">
    <iframe id="excelFrame" title="Excel TV Display" allowfullscreen></iframe>
    <div id="controls">
      <button onclick="goFullscreen()">Go Fullscreen</button>
      <button onclick="reloadFrame()">Refresh Now</button>
    </div>
    <div id="hint">Loading…</div>
  </div>
</body>
</html>
